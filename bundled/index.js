!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("mongo-scanner",[],e):"object"==typeof exports?exports["mongo-scanner"]=e():t["mongo-scanner"]=e()}(this,(function(){return(()=>{"use strict";var t={184:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionError=void 0;var i=function(t){function e(n,r,o,i){var s=t.call(this,null!=n?n:e.DEFAULT_MESSAGE)||this;return s.name="MongoScannerConnectionError",s.uri=null!=r?r:null,s.options=null!=o?o:null,s.triggerError=null!=i?i:null,s}return o(e,t),e.DEFAULT_MESSAGE="Error in connecting to MongoDB",e}(n(669).MongoScannerError);e.ConnectionError=i},921:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.DisconnectionError=void 0;var i=function(t){function e(n,r,o,i){var s=t.call(this,null!=n?n:e.DEFAULT_MESSAGE)||this;return s.name="MongoScannerDisconnectionError",s.uri=null!=r?r:null,s.options=null!=o?o:null,s.triggerError=null!=i?i:null,s}return o(e,t),e.DEFAULT_MESSAGE="Error in disconnecting to MongoDB",e}(n(669).MongoScannerError);e.DisconnectionError=i},686:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),o(n(669),e),o(n(184),e),o(n(921),e),o(n(898),e),o(n(677),e)},677:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.ListCollectionsError=void 0;var i=function(t){function e(n,r,o){var i=t.call(this,null!=n?n:e.DEFAULT_MESSAGE)||this;return i.name="MongoScannerListCollectionsError",i.db=r,i.triggerError=null!=o?o:null,i}return o(e,t),e.DEFAULT_MESSAGE="Error in listing collections",e}(n(669).MongoScannerError);e.ListCollectionsError=i},898:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.ListDatabasesError=void 0;var i=function(t){function e(n,r){var o=t.call(this,null!=n?n:e.DEFAULT_MESSAGE)||this;return o.name="MongoScannerListDatabasesError",o.triggerError=null!=r?r:null,o}return o(e,t),e.DEFAULT_MESSAGE="Error in listing databases",e}(n(669).MongoScannerError);e.ListDatabasesError=i},669:function(t,e){var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.MongoScannerError=void 0;var o=function(t){function e(e){var n=this,r=this.constructor.prototype;return(n=t.call(this,e)||this).__proto__=r,n.name="MongoScannerError",n}return r(e,t),e}(Error);e.MongoScannerError=o},992:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.MongoScanner=void 0,o(n(686),e);var c=n(385),a=n(473),u=n(686),l={useCache:!1,excludeDatabases:void 0,excludeCollections:void 0,excludeSystem:!1,excludeEmptyDatabases:!1,ignoreLackOfPermissions:!1,onLackOfPermissions:function(){}},f=function(){function t(t,e,n){this.uri=t,this.connectionOptions=e,this.options=n,this.database=null,this.cache=new a.Cache,this.persistentConnected=!1,this.persistentActives=0}return Object.defineProperty(t.prototype,"uri",{get:function(){return this._uri},set:function(t){this._uri=t||"mongodb://localhost:27017"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionOptions",{get:function(){return this._connectionOptions},set:function(t){this._connectionOptions=t||{}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(t){this._options=this.mergeOptionsWithDefault(t)},enumerable:!1,configurable:!0}),t.prototype.mergeOptionsWithDefault=function(t){t=t||{};var e={};for(var n in l)e[n]=void 0===t[n]?l[n]:t[n];return e},t.prototype.mergeOptions=function(t){t=t||{};var e={};for(var n in this.options)e[n]=void 0===t[n]?this.options[n]:t[n];return e},t.prototype.passes=function(t,e){return e.every((function(e){return"string"==typeof e?t!==e:!e.test(t)}))},t.prototype.filterDatabases=function(t,e){var n=this,r=t;if(e.excludeDatabases){var o=Array.isArray(e.excludeDatabases)?e.excludeDatabases:[e.excludeDatabases];r=r.filter((function(t){return n.passes(t,o)}))}return r},t.prototype.filterCollections=function(t,e){var n=this,r=t;if(e.excludeSystem&&(r=r.filter((function(t){return!/^system./.test(t)}))),e.excludeCollections){var o=Array.isArray(e.excludeCollections)?e.excludeCollections:[e.excludeCollections];r=r.filter((function(t){return n.passes(t,o)}))}return r},t.prototype._listDatabases=function(t,e){return i(this,void 0,void 0,(function(){var n,r,o,i,a,l;return s(this,(function(s){switch(s.label){case 0:return t.useCache&&(n=this.cache.listDatabases()),n?[3,9]:(o=!1,(r=e)?[3,3]:this.persistentConnected?(this.persistentActives++,o=!0,r=this.database,[3,3]):[3,1]);case 1:return r=new c.Database(this.uri,this.connectionOptions),[4,c.Database.connectDatabase(r)];case 2:s.sent(),s.label=3;case 3:return s.trys.push([3,5,6,9]),[4,r.listDatabases()];case 4:return n=s.sent(),this.cache.cacheDatabases(n),[3,9];case 5:if(i=s.sent(),a=new u.ListDatabasesError(null,i),t.onLackOfPermissions(null,a),t.ignoreLackOfPermissions)return[2,[]];throw a;case 6:return l=null===e,o&&(this.persistentActives--,l=!this.persistentConnected&&0===this.persistentActives),l?[4,c.Database.disconnectDatabase(r)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[7];case 9:return[2,n=this.filterDatabases(n,t)]}}))}))},t.prototype._listCollections=function(t,e,n){return i(this,void 0,void 0,(function(){var r,o,i,a,l,f;return s(this,(function(s){switch(s.label){case 0:return e.useCache&&(r=this.cache.listCollections(t)),r?[3,9]:(i=!1,(o=n)?[3,3]:this.persistentConnected?(this.persistentActives++,i=!0,o=this.database,[3,3]):[3,1]);case 1:return o=new c.Database(this.uri,this.connectionOptions),[4,c.Database.connectDatabase(o)];case 2:s.sent(),s.label=3;case 3:return s.trys.push([3,5,6,9]),[4,o.listCollections(t)];case 4:return r=s.sent(),this.cache.cacheCollections(t,r),[3,9];case 5:if(a=s.sent(),l=new u.ListCollectionsError(null,t,a),e.onLackOfPermissions(null,l),e.ignoreLackOfPermissions)return[2,[]];throw l;case 6:return f=null===n,i&&(this.persistentActives--,f=!this.persistentConnected&&0===this.persistentActives),f?[4,c.Database.disconnectDatabase(o)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[7];case 9:return[2,r=this.filterCollections(r,e)]}}))}))},t.prototype.startConnection=function(){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.database=new c.Database(this.uri,this.connectionOptions),[4,c.Database.connectDatabase(this.database)];case 1:return t.sent(),this.persistentConnected=!0,[2]}}))}))},t.prototype.endConnection=function(){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.persistentConnected=!1,0!==this.persistentActives?[3,2]:[4,c.Database.disconnectDatabase(this.database)];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.listDatabases=function(t){return i(this,void 0,void 0,(function(){var e;return s(this,(function(n){return e=this.mergeOptions(t),[2,this._listDatabases(e,null)]}))}))},t.prototype.listCollections=function(t,e){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return n=this.mergeOptions(e),[2,this._listCollections(t,n,null)]}))}))},t.prototype.getSchema=function(t){return i(this,void 0,void 0,(function(){var e,n,r,o,i,a,u,l,f,p,h;return s(this,(function(s){switch(s.label){case 0:return e=this.mergeOptions(t),n={},this.persistentConnected?(this.persistentActives++,o=!0,r=this.database,[3,3]):[3,1];case 1:return o=!1,r=new c.Database(this.uri,this.connectionOptions),[4,c.Database.connectDatabase(r)];case 2:s.sent(),s.label=3;case 3:return[4,this._listDatabases(e,r)];case 4:i=s.sent(),a=0,u=i,s.label=5;case 5:return a<u.length?(l=u[a],f=n,p=l,[4,this._listCollections(l,e,r)]):[3,8];case 6:f[p]=s.sent(),e.excludeEmptyDatabases&&!n[l].length&&delete n[l],s.label=7;case 7:return a++,[3,5];case 8:return h=!0,o&&(this.persistentActives--,h=!this.persistentConnected&&0===this.persistentActives),h?[4,c.Database.disconnectDatabase(r)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[2,n]}}))}))},t.prototype.clearCache=function(){this.cache.refreshCache()},t}();e.MongoScanner=f},473:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cache=void 0;var n=function(){function t(){this.schema={databases:null,collections:{}}}return t.prototype.listDatabases=function(){return this.schema.databases},t.prototype.listCollections=function(t){return this.schema.collections[t]||null},t.prototype.cacheDatabases=function(t){this.schema.databases=t},t.prototype.cacheCollections=function(t,e){this.schema.collections[t]=e},t.prototype.refreshCache=function(){this.schema={databases:null,collections:{}}},t}();e.Cache=n},385:function(t,e,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Database=void 0;var s=n(548),c=n(686),a=function(){function t(t,e){this.connection=null,this.options={useUnifiedTopology:!0,useNewUrlParser:!0},this.uri=t,this.options=r(r({},e),this.options)}return Object.defineProperty(t.prototype,"connected",{get:function(){return null!==this.connection},enumerable:!1,configurable:!0}),t.connectDatabase=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.connect()];case 1:return n.sent(),[3,3];case 2:throw e=n.sent(),new c.ConnectionError(null,t.uri,t.options,e);case 3:return[2]}}))}))},t.disconnectDatabase=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.disconnect()];case 1:return n.sent(),[3,3];case 2:throw e=n.sent(),new c.DisconnectionError(null,t.uri,t.options,e);case 3:return[2]}}))}))},t.prototype.connect=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.connected?[3,2]:(t=this,[4,s.MongoClient.connect(this.uri,this.options)]);case 1:t.connection=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.listDatabases=function(){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.connection.db().admin().listDatabases()];case 1:return[2,t.sent().databases.map((function(t){return t.name}))]}}))}))},t.prototype.listCollections=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.connection.db(t).listCollections().toArray()];case 1:return[2,e.sent().map((function(t){return t.name}))]}}))}))},t.prototype.disconnect=function(){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.connected?[4,this.connection.close()]:[3,2];case 1:t.sent(),this.connection=null,t.label=2;case 2:return[2]}}))}))},t}();e.Database=a},548:t=>{t.exports=require("mongodb")}},e={};return function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}(992)})()}));